{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

    <title>{% trans 'Chat with Assistant' %}</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f2f2f2;
        }

        #chat {
            width: 80%;
            max-width: 600px;
            margin: auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        #chat-box {
            height: 300px;
            overflow: auto;
            border: 1px solid #ccc;
            margin-bottom: 20px;
            padding: 10px;
            background: #e9e9e9;
            border-radius: 4px;
        }

        #user-input {
            width: calc(100% - 120px); /* Adjust width minus button width */
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        button {
            width: 100px;
            padding: 10px;
            margin-left: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .message {
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 4px;
            background-color: #f1f1f1;
        }

        .navbar {
        {#background-color: #0097B2;#}
            background: linear-gradient(to bottom, #AEDFF7, #0077B6);
        }

        .navbar-brand {
            color: #0097B2;
            font-size: 1.5rem;
            font-weight: bold;
        }
        :root {
            --dark-color: #111;
            --light-color: #eee;
            --background-color: var(--dark-color);
            --text-color: var(--light-color);
            --button-bg-color: var(--light-color);
            --button-text-color: var(--dark-color);
        }

        body.dark-mode {
            --background-color: var(--dark-color);
            --text-color: var(--light-color);
            --button-bg-color: var(--light-color);
            --button-text-color: var(--dark-color);
        }

        body.light-mode {
            --background-color: var(--light-color);
            --text-color: var(--dark-color);
            --button-bg-color: var(--dark-color);
            --button-text-color: var(--light-color);
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
        }

        button {
            background-color: var(--button-bg-color);
            color: var(--button-text-color);
        }
        body {
            background-image: url('{% static 'images/banc.png' %} '); /* Remplacez avec le chemin rÃ©el de votre image */
            background-size: cover; /* Couvre toute la page, peut Ãªtre ajustÃ© selon les besoins */
            background-position: center; /* Centrer l'image dans la page */
            background-repeat: no-repeat; /* Pour ne pas rÃ©pÃ©ter l'image */
            background-attachment: fixed; /* Fixe l'image, elle ne dÃ©file pas avec le contenu */
        }

        h1, h2 {
            color: #0097b2;
        }

        .message-user {
            background-color: #d1e8ff; /* Couleur de fond pour les messages de l'utilisateur */
            color: #333; /* Couleur du texte */
            text-align: left;
            padding: 10px;
            margin: 5px;
            border-radius: 10px;
        }

        .message-assistant {
            background-color: #fde8cd; /* Couleur de fond pour les messages de l'assistant */
            color: #333; /* Couleur du texte */
            text-align: right;
            padding: 10px;
            margin: 5px;
            border-radius: 10px;
        }


    </style>

</head>
<body id="body" class="light-mode">
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <a class="navbar-brand" href="#">
        Be linked
    </a>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ml-auto">
            <a class="nav-link custom-link" href="{% url 'user_page' %}">{% trans 'User Page' %}</a>
            <button type="button" id="dark-light-toggle" onclick="toggleDarkLight()" title="Toggle dark/light mode">ðŸŒ›</button>
        </ul>
    </div>
</nav>

<div id="chat">
    <h1>{% trans 'Hi I am your math mentor !' %}</h1>
    <h2>{% trans 'Ask me any question about maths !' %}</h2>
    <div id="chat-box" style="height:300px; overflow:auto; border:1px solid #ccc; padding:10px;">
        <!-- Chat messages will appear here -->
    </div>
    <input type="text" id="user-input" placeholder="I need to solve the equation 3x + 11 = 14. Can you help me?..." onkeypress="handleKeyPress(event)">
    <button onclick="sendMessage()">{% trans 'Send' %}</button>
</div>


<script>
    // Helper function to capitalize the first letter of a string
    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
    function sendMessage() {
        var userInput = document.getElementById('user-input').value;
        var chatBox = document.getElementById('chat-box');

        // Add the user's message to the chat box
        chatBox.innerHTML += '<div class="message message-user">User: ' + userInput + '</div>';

        // Send the message to the Django backend using AJAX
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/chat_with_assistant/?message=' + encodeURIComponent(userInput), true);
        xhr.onreadystatechange = function() {
            if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                var response = JSON.parse(this.responseText);
                chatBox.innerHTML += '<div class="message message-assistant">Assistant: ' + response.reply + '</div>';
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        };

        xhr.send();

        // Clear the input field
        document.getElementById('user-input').value = '';
    }

    function handleKeyPress(event) {
        if (event.key === "Enter") {
            sendMessage();
        }
    }


    function toggleDarkLight() {
        var body = document.getElementById("body");
        var currentClass = body.className;
        body.className = currentClass === "dark-mode" ? "light-mode" : "dark-mode";
    }

</script>

</body>
</html>
